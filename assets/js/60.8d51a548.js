(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{536:function(t,e,r){t.exports=r.p+"assets/img/EventLoop.ba152b0b.png"},701:function(t,e,r){"use strict";r.r(e);var s=r(10),_=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"九、手写promise"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#九、手写promise"}},[t._v("#")]),t._v(" 九、手写Promise")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.cn/post/6945319439772434469",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文章"),e("OutboundLink")],1)]),t._v(" "),e("ol",[e("li",[t._v("Promise 是一个类，在执行这个类的时候会传入一个执行器，这个执行器会立即执行")]),t._v(" "),e("li",[t._v("Promise 会有三种状态\n"),e("ul",[e("li",[t._v("Pending 等待")]),t._v(" "),e("li",[t._v("Fulfilled 完成")]),t._v(" "),e("li",[t._v("Rejected 失败")])])]),t._v(" "),e("li",[t._v("状态只能由 Pending --\x3e Fulfilled 或者 Pending --\x3e Rejected，且一但发生改变便不可二次修改；")]),t._v(" "),e("li",[t._v("Promise 中使用 resolve 和 reject 两个函数来更改状态；")]),t._v(" "),e("li",[t._v("then 方法内部做但事情就是状态判断\n"),e("ul",[e("li",[t._v("如果状态是成功，调用成功回调函数")]),t._v(" "),e("li",[t._v("如果状态是失败，调用失败回调函数")])])])]),t._v(" "),e("h2",{attrs:{id:"_1-什么是宏任务与微任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是宏任务与微任务"}},[t._v("#")]),t._v(" 1.什么是宏任务与微任务")]),t._v(" "),e("p",[t._v("Js 是单线程都，但是一些高耗时操作就带来了进程阻塞问题")]),t._v(" "),e("p",[t._v("为了解决这个问题，Js 有两种任务的执行模式："),e("strong",[t._v("同步模式（Synchronous）和 异步模式（Asynchronous）")])]),t._v(" "),e("p",[t._v("在异步模式下，创建异步任务主要分为"),e("strong",[t._v("宏任务")]),t._v("与"),e("strong",[t._v("微任务")]),t._v("两种。")]),t._v(" "),e("p",[t._v("ES6 规范中，"),e("strong",{staticStyle:{color:"#DD5145"}},[t._v("宏任务（Macrotask） 称为 Task， 微任务（Microtask） 称为 Jobs。")])]),t._v(" "),e("p",[t._v("宏任务是"),e("strong",[t._v("由宿主（浏览器、Node）发起的")]),t._v("，而微任务"),e("strong",[t._v("由 JS 自身发起")]),t._v("。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("宏任务（Macrotask）")]),t._v(" "),e("th",[t._v("微任务（Microtask）")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("strong",[e("code",[t._v("setTimeout")])])]),t._v(" "),e("td",[t._v("requestAnimationFrame（有争议）")])]),t._v(" "),e("tr",[e("td",[e("strong",[e("code",[t._v("setInterval")])])]),t._v(" "),e("td",[t._v("MutationObserver（浏览器环境）")])]),t._v(" "),e("tr",[e("td",[t._v("postMessage、MessageChannel")]),t._v(" "),e("td",[e("strong",[e("code",[t._v("Promise.[then/catch/finally]")])])])]),t._v(" "),e("tr",[e("td",[t._v("I/O，事件队列")]),t._v(" "),e("td",[t._v("process.nextTick（Node环境）")])]),t._v(" "),e("tr",[e("td",[t._v("setImmediate（Node环境）")]),t._v(" "),e("td",[t._v("queueMicrotask")])]),t._v(" "),e("tr",[e("td",[t._v("script（整体代码块）")]),t._v(" "),e("td",[t._v("Object.observe（已废弃；Proxy 对象替代）")])])])]),t._v(" "),e("p",[e("strong",[t._v("如何理解 script（整体代码块）是个宏任务呢")])]),t._v(" "),e("p",[t._v("实际上如果同时存在两个 script 代码块，会首先在执行第一个 script 代码块中的同步代码，如果这个过程中创建了微任务并进入了微任务队列，第一个 script 同步代码执行完之后，会首先去清空微任务队列，再去开启第二个 script 代码块的执行。所以这里应该就可以理解 script（整体代码块）为什么会是宏任务。")]),t._v(" "),e("h2",{attrs:{id:"_2-什么是-eventloop"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-什么是-eventloop"}},[t._v("#")]),t._v(" 2.什么是 EventLoop")]),t._v(" "),e("ol",[e("li",[t._v("判断宏任务队列是否为空\n"),e("ul",[e("li",[t._v("不空 --\x3e 执行最早进入队列的任务 --\x3e 执行下一步")]),t._v(" "),e("li",[t._v("空 --\x3e 执行下一步")])])]),t._v(" "),e("li",[t._v("判断微任务队列是否为空\n"),e("ul",[e("li",[t._v("不空 --\x3e 执行最早进入队列的任务 --\x3e "),e("strong",[t._v("继续检查微任务队列空不空")])]),t._v(" "),e("li",[t._v("空 --\x3e 执行下一步")])])])]),t._v(" "),e("p",[t._v("因为首次执行宏队列中会有 script（整体代码块）任务，所以实际上就是 Js 解析完成后，在异步任务中，会先执行完所有的微任务")]),t._v(" "),e("p",[t._v("需要注意的是，新创建的微任务会"),e("strong",[t._v("立即进入微任务队列排队执行")]),t._v("，不需要等待下一次轮回")]),t._v(" "),e("p",[e("img",{attrs:{src:r(536),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"_3-什么是-promise-a-规范"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-什么是-promise-a-规范"}},[t._v("#")]),t._v(" 3.什么是 Promise A+ 规范")]),t._v(" "),e("p",[t._v("检验一份手写 Promise 靠不靠谱，通过 Promise A+ 规范自然是基本要求，这里我们可以借助 "),e("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fpromises-aplus-tests",target:"_blank",rel:"noopener noreferrer"}},[t._v("promises-aplus-tests"),e("OutboundLink")],1),t._v(" 来检测我们的代码是否符合规范。")]),t._v(" "),e("h2",{attrs:{id:"面试题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#面试题"}},[t._v("#")]),t._v(" 面试题")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.cn/post/6844904077537574919",target:"_blank",rel:"noopener noreferrer"}},[t._v("45道面试题"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=_.exports}}]);