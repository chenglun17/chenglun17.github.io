(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{464:function(t,s,a){t.exports=a.p+"assets/img/浏览器内核（渲染进程）.3d8e09ab.png"},465:function(t,s,a){t.exports=a.p+"assets/img/Worker线程.2751da47.png"},466:function(t,s,a){t.exports=a.p+"assets/img/主线程与Worker线程之间的通信.68e3f5d2.png"},671:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"web-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web-worker"}},[t._v("#")]),t._v(" Web Worker")]),t._v(" "),s("h2",{attrs:{id:"扩展-浏览器内核"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩展-浏览器内核"}},[t._v("#")]),t._v(" 扩展 -- 浏览器内核")]),t._v(" "),s("p",[s("strong",[t._v("浏览器最核心的部分是 “Rendering Engine”，即 “渲染引擎”，又称 “浏览器内核”。")]),t._v(" 主要包括以下线程：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(464),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_1-gui-渲染线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-gui-渲染线程"}},[t._v("#")]),t._v(" 1. GUI 渲染线程")]),t._v(" "),s("p",[t._v("GUI 渲染线程负责"),s("strong",[t._v("渲染浏览器界面，解析HTML, CSS, 构建DOM树 和 RenderObject树，布局和绘制等")]),t._v("。")]),t._v(" "),s("p",[t._v("当界面需要重绘（Repaint）或由于某种操作引发回流（Reflow）时，该线程就会执行。")]),t._v(" "),s("h3",{attrs:{id:"_2-javascript-引擎线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-javascript-引擎线程"}},[t._v("#")]),t._v(" 2. JavaScript 引擎线程")]),t._v(" "),s("p",[t._v("JavaScript 引擎线程负责"),s("strong",[t._v("解析 JavaScript 脚本并运行相关代码")]),t._v("。 JavaScript 引擎一直等待着任务队列中任务的到来，然后进行处理，一个Tab页（Renderer 进程）中无论什么时候都只有一个 JavaScript 线程在运行 JavaScript 程序。")]),t._v(" "),s("p",[t._v("需要注意的是，"),s("strong",{staticStyle:{color:"#DD5145"}},[t._v("GUI 渲染线程与 JavaScript 引擎线程是互斥的")]),t._v("，所以如果 JavaScript 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染被阻塞。")]),t._v(" "),s("h3",{attrs:{id:"_3-事件触发线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-事件触发线程"}},[t._v("#")]),t._v(" 3. 事件触发线程")]),t._v(" "),s("p",[t._v("当一个事件被触发时该线程会把事件"),s("strong",[t._v("添加到待处理队列的队尾")]),t._v("，等待 JavaScript 引擎的处理。")]),t._v(" "),s("p",[t._v("这些事件可以是当前执行的代码块如定时任务、也可来自浏览器内核的其他线程如鼠标点击、AJAX 异步请求等，但由于 JavaScript 引擎是单线程的，所有这些事件都得排队等待 JavaScript 引擎处理。")]),t._v(" "),s("h3",{attrs:{id:"_4-定时触发器线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-定时触发器线程"}},[t._v("#")]),t._v(" 4. 定时触发器线程")]),t._v(" "),s("p",[t._v("浏览器定时计数器并不是由 JavaScript 引擎计数的，这是因为 JavaScript 引擎是单线程的，如果处于阻塞线程状态就会影响记计时的准确，所以通过单独线程来计时并触发定时是更为合理的方案。我们日常开发中常用的 "),s("code",[t._v("setInterval")]),t._v(" 和 "),s("code",[t._v("setTimeout")]),t._v(" 就在该线程中。")]),t._v(" "),s("h3",{attrs:{id:"_5-http-异步请求线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-http-异步请求线程"}},[t._v("#")]),t._v(" 5. Http 异步请求线程")]),t._v(" "),s("p",[t._v("在 XMLHttpRequest 在连接后是通过浏览器新开一个线程请求， 将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件放到 JavaScript 引擎的处理队列中等待处理。")]),t._v(" "),s("h2",{attrs:{id:"一、web-worker-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、web-worker-是什么"}},[t._v("#")]),t._v(" 一、Web Worker 是什么")]),t._v(" "),s("h3",{attrs:{id:"_1-基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本概念"}},[t._v("#")]),t._v(" 1.基本概念")]),t._v(" "),s("p",[t._v("Web Worker 是 HTML5 提供的一个 JavaScript 多线程解决方案。")]),t._v(" "),s("ul",[s("li",[t._v("JavaScript 语言采用的是单线程模型，也就是说，所有任务只能在一个现场上完成，一次只能做一件事")])]),t._v(" "),s("p",[t._v("Web Worker 的出现，就是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行。在主线程运行的同时，Worker 线程在后台运行，两则互不干扰。")]),t._v(" "),s("ul",[s("li",[t._v("一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务")])]),t._v(" "),s("p",[t._v("通过使用 Web Workers，Web 应用程序可以在独立于主线程的后台线程中，运行一个脚本操作。这样做的好处是可以在独立线程中执行费时的处理任务，从而允许主线程（通常是UI线程）不会因此被阻塞/放慢。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(465),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_2-几个注意点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-几个注意点"}},[t._v("#")]),t._v(" 2.几个注意点")]),t._v(" "),s("p",[t._v("Web Worker 有几个使用注意点：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("同源限制")])]),t._v(" "),s("p",[t._v("分配给 Worker 线程运行的脚本文件，必须与主线程脚本文件同源")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("DOM限制")])]),t._v(" "),s("p",[t._v("Worker 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用 "),s("code",[t._v("window")]),t._v("、"),s("code",[t._v("document")]),t._v("等对象，但可以使用 "),s("code",[t._v("navigator")]),t._v("和"),s("code",[t._v("location")]),t._v("对象")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("通信联系")])]),t._v(" "),s("p",[t._v("Worker 线程和主线程不在同一个上下文环境，他们不能直接通信，必须通过"),s("strong",{staticStyle:{color:"#DD5145"}},[t._v("信息")]),t._v("完成通信")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("脚本限制")])]),t._v(" "),s("p",[t._v("Worker 线程不能执行"),s("code",[t._v("alert()")]),t._v("和"),s("code",[t._v("confirm()")]),t._v("方法，但可以使用"),s("code",[t._v("XMLHttpRequest")]),t._v("对象发出的"),s("code",[t._v("AJAX")]),t._v("请求，但是 "),s("code",[t._v("XMLHttpRequest")]),t._v(" 对象的 "),s("code",[t._v("responseXML")]),t._v(" 和 "),s("code",[t._v("channel")]),t._v(" 这两个属性的值将总是 "),s("code",[t._v("null")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("文本限制")])]),t._v(" "),s("p",[t._v("Worker 线程无法读取本地文件（"),s("code",[t._v("file://")]),t._v("），它所加载的脚本，"),s("strong",{staticStyle:{color:"#DD5145"}},[t._v("必须来自网络")])])]),t._v(" "),s("li",[s("p",[t._v("Worker 线程上下文也存在一个顶级对象"),s("strong",{staticStyle:{color:"#DD5145"}},[s("code",[t._v("self")])]),t._v("（类似浏览器中的 window对象）")])])]),t._v(" "),s("p",[t._v("绝大多数 Window 对象上的方法和属性，都被共享到 Worker 上下文全局对象 WorkerGlobalScope 中。")]),t._v(" "),s("h2",{attrs:{id:"二、web-worker-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、web-worker-api"}},[t._v("#")]),t._v(" 二、Web Worker API")]),t._v(" "),s("h3",{attrs:{id:"_1-主线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-主线程"}},[t._v("#")]),t._v(" 1. 主线程")]),t._v(" "),s("p",[t._v("1.1 主线程调用 "),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("Worker()")])]),t._v("构造函数"),s("code",[t._v("new")]),t._v("一个 Worker 线程，它接收两个参数：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" worker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" worker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'worker.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("由于 Worker 不能读取本地文件，这个脚本必须来自网络，如果没有下载成功（例如404），Worker 就会失败")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("path")]),t._v(" "),s("td",[t._v("有效的 js 脚本地址，必须遵守同源策略，否则会抛出"),s("code",[t._v("SecurityError")]),t._v("错误")])]),t._v(" "),s("tr",[s("td",[t._v("options.type")]),t._v(" "),s("td",[t._v("可选，指定 worker 类型，该值可以是 classic 或 module。未指定，将使用默认值 classic")])]),t._v(" "),s("tr",[s("td",[t._v("options.credentials")]),t._v(" "),s("td",[t._v("可选，指定 worker 凭证，该值可以是 omit、same-origin 或 include。未指定 或 type 为 classic，将使用默认值 omit（不需要凭证）")])]),t._v(" "),s("tr",[s("td",[t._v("options.name")]),t._v(" "),s("td",[t._v("可选，在 DedicatedWorkerGlobalScope 的情况下，用来表示 Worker 的 scope 的一个 DOMString 值，主要用于调式目的")])])])]),t._v(" "),s("p",[t._v("1.2 主线程调用"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("worker.postMessage()")])]),t._v("方法，向 Worker 线程发送消息：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'echo'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'work'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("worker.postMessage()")]),t._v("方法的参数，就是主线程传给 Worker 的数据，它可以是"),s("strong",[t._v("各种类型的数据")]),t._v("，包括二进制数据")])]),t._v(" "),s("p",[t._v("1.3 主线程通过"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("worker.onMessage")])]),t._v("指定监听函数，接收来自 Worker 线程发送的信息：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Received message ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onMessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Received message ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("1.4 Worker 线程完成任务以后，主线程可以调用"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("terminate()")])]),t._v("方法把它关掉：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("terminate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-worker-线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-worker-线程"}},[t._v("#")]),t._v(" 2. Worker 线程")]),t._v(" "),s("p",[t._v("Worker 线程内部需要有一个监听函数，来监听 "),s("strong",{staticStyle:{color:"#27ba9b"}},[t._v("message 事件")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("You said: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",{staticStyle:{color:"#DD5145"}},[s("code",[t._v("self")])]),t._v("代表子线程自身，即子线程的全局对象。等价于下面两种写法")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法一")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("You said: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写法二")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("You said: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("除了使用"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("self.addEventListener()")])]),t._v("指定监听函数，也可以使用"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("self.onMessage")])]),t._v("指定。监听函数的参数是一个事件对象，它的"),s("code",[t._v("data")]),t._v("属性包含主线程发来的数据。"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("self.postMessage()")])]),t._v("方法用来向主线程发送消息，"),s("strong",{staticStyle:{color:"orange"}},[s("code",[t._v("self.close()")])]),t._v("用于在 Worker 线程内部关闭自身")]),t._v(" "),s("h3",{attrs:{id:"_3-监听错误信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-监听错误信息"}},[t._v("#")]),t._v(" 3. 监听错误信息")]),t._v(" "),s("p",[t._v("Web Worker 提供两个事件监听错误，"),s("strong",{staticStyle:{color:"#27ba9b"}},[t._v("error 事件 和 messageerror 事件")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("事件")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("error")]),t._v(" "),s("td",[t._v("当 Worker 内部出现错误时触发")])]),t._v(" "),s("tr",[s("td",[t._v("messageerror")]),t._v(" "),s("td",[t._v("当 message 事件接收到"),s("strong",[t._v("无法被反序列化")]),t._v("的参数时触发")])])])]),t._v(" "),s("p",[t._v("主线程可以监听 Worker 是否发送错误，如果发生错误，Worker 会触发主线程"),s("code",[t._v("error")]),t._v("事件：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("worker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ERROR: Line'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lineno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onerror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("Worker 内部也可以监听 "),s("code",[t._v("error")]),t._v("事件")])]),t._v(" "),s("h3",{attrs:{id:"_4-关闭-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-关闭-worker"}},[t._v("#")]),t._v(" 4. 关闭 Worker")]),t._v(" "),s("p",[t._v("使用完之后，为了节省系统资源，必须关闭 Worker")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 主线程")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("terminate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Worker 线程")]),t._v("\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("无论是在主线程关闭 Worker ，还是在 Worker 线程内部关闭 Worker ，Worker 线程当前的 Event Loop 中的任务会继续执行。而 Worker 线程下一个 Event Loop 中的任务，则会被直接忽略，不会继续执行。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在主线程关闭 Worker ，主线程与 Worker 线程之间的连接都会被立刻停止，即使 Worker 线程当前的 Event Loop 中仍有待执行的任务继续调用 "),s("code",[t._v("postMessage()")]),t._v(" 方法，但主线程不会再接收到消息。")])]),t._v(" "),s("li",[s("p",[t._v("在 Worker 线程内部关闭 Worker ，不会直接断开与主线程的连接，而是等 Worker 线程当前的 Event Loop 所有任务执行完，再关闭。即，在当前 Event Loop 中继续调用 "),s("code",[t._v("postMessage()")]),t._v(" 方法，主线程还是能通过监听"),s("code",[t._v("message")]),t._v("事件收到消息的。")])])]),t._v(" "),s("h3",{attrs:{id:"_5-worker-加载脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-worker-加载脚本"}},[t._v("#")]),t._v(" 5. Worker 加载脚本")]),t._v(" "),s("p",[t._v("Worker 内部如果要加载其他脚本，需要一个专门的方法"),s("code",[t._v("importScript()")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("importScript")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script1.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("该方法可以同时加载多个脚本：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("importScript")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script1.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script2.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_6-esmodule-模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-esmodule-模式"}},[t._v("#")]),t._v(" 6.ESModule 模式")]),t._v(" "),s("p",[t._v("当项目的 js 文件都用的是 ESModule 模式时，"),s("code",[t._v("importScripts()")]),t._v(" 导入js文件时，发现执行失败")]),t._v(" "),s("p",[t._v("需要在初始化 Worker 时选择第二个可选参数，使用 module 模式初始化 Worker 线程！")]),t._v(" "),s("p",[t._v("主线程")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js（主线程）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" worker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/worker.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'module'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定 worker.js 的类型")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Worker 线程")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// worker.js（worker线程）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" add "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./utils.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 导入外部js")]),t._v("\n\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// log 3")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只需把顶级对象self暴露出去即可")]),t._v("\n")])])]),s("p",[t._v("js文件")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// utils.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"三、web-worker-数据通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、web-worker-数据通信"}},[t._v("#")]),t._v(" 三、Web Worker 数据通信")]),t._v(" "),s("p",[t._v("主线程与 Worker 线程之间的通信内容，可以是文本，也可以是对象。注意，这种通信是拷贝关系。即，数据传递是"),s("strong",{staticStyle:{color:"#DD5145"}},[t._v("传值而不是传地址")]),t._v("，Worker 对通信内容的修改，不会影响到主线程。")]),t._v(" "),s("p",[t._v("所以你会发现，即使你传递的是一个"),s("code",[t._v("Object")]),t._v("，并且被直接传递回来，接收到的也不是原来的那个值了。")]),t._v(" "),s("ul",[s("li",[t._v("浏览器内部的运行机制：先将通信内容串行化，然后把串行化后的字符串发送给 Worker，后者再将它还原。")])]),t._v(" "),s("p",[t._v("为了解决这个问题，JavaScript 运行主线程把二进制数据直接转移给子线程，但是一旦转移，主线程就无法再使用这些二进制数据了，这是为了防止出现多个线程同时修改数据，这种转移数据的方法，叫做 Transferable Objects。")]),t._v(" "),s("p",[t._v("这使得主线程可以快速把数据交给 Worker，对于映像处理、声音处理、3D运算等就很方便，不会产生性能负担。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Transferable Objects 格式")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arrayBuffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("arrayBuffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" exp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayBuffer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nworker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("exp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:a(466),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"四、web-worker-分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、web-worker-分类"}},[t._v("#")]),t._v(" 四、Web Worker 分类")]),t._v(" "),s("p",[t._v("Web Worker 规范中定义了两类工作线程，"),s("strong",[t._v("专用线程 Dedicated Worker")]),t._v(" 和 "),s("strong",[t._v("共享线程 Shared Worker")]),t._v("。")]),t._v(" "),s("p",[t._v("其中，Dedicated Worker 只能为一个页面所使用，而 Shared Worker 则可以被多个页面所共享。")]),t._v(" "),s("h3",{attrs:{id:"_1-dedicated-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-dedicated-worker"}},[t._v("#")]),t._v(" 1.Dedicated Worker")]),t._v(" "),s("h3",{attrs:{id:"_2-shared-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-shared-worker"}},[t._v("#")]),t._v(" 2.Shared Worker")]),t._v(" "),s("p",[s("strong",[t._v("SharedWorker")]),t._v(" 是一种特殊类型的 Worker，可以被多个浏览上下文访问，比如多个 windows，iframes 和 workers，但这些浏览上下文必须同源。")]),t._v(" "),s("p",[t._v("使用场景：点赞计数器 ...")]),t._v(" "),s("h2",{attrs:{id:"五、service-workers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、service-workers"}},[t._v("#")]),t._v(" 五、Service Workers")]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN文档"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://juejin.cn/post/7139718200177983524",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文章"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://juejin.cn/post/6844904198639714311",target:"_blank",rel:"noopener noreferrer"}},[t._v("你不知道的 Web Workers"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);