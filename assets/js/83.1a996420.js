(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{578:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"八、逻辑复用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#八、逻辑复用"}},[t._v("#")]),t._v(" 八、逻辑复用")]),t._v(" "),s("h2",{attrs:{id:"_1-组合式函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-组合式函数"}},[t._v("#")]),t._v(" 1.组合式函数")]),t._v(" "),s("p",[t._v("Vue3 中的 Composables(Composables) ，它是一个利用 Vue 的组合式 API 来封装和复用有状态逻辑的函数。功能类似 Vue2 的 mixins，但又有所不同。")]),t._v(" "),s("p",[t._v("Vue 官方称为 Composables 组合式函数。简单理解其实就是类 React Hooks 式的组合式函数封装方法。")]),t._v(" "),s("p",[t._v("注意：组合式函数约定用驼峰命名法命名，并以“use”作为开头。")]),t._v(" "),s("h2",{attrs:{id:"_2-自定义指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-自定义指令"}},[t._v("#")]),t._v(" 2.自定义指令")]),t._v(" "),s("p",[t._v("我们已经介绍了两种在 Vue 中重用代码的方式：组件 和 组合式函数。")]),t._v(" "),s("p",[t._v("组件是主要的构建模块，而组合式函数则侧重于有状态的逻辑。"),s("a",{attrs:{href:"https://cn.vuejs.org/guide/reusability/custom-directives.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("自定义指令"),s("OutboundLink")],1),t._v(" 主要是为了重用涉及普通元素的底层 DOM 访问的逻辑。")]),t._v(" "),s("p",[t._v("将一个自定义指令全局注册到应用层级也是一种常见的做法：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// src/main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使 v-demo 在所有组件中都可用")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("directive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'demo'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ... */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"指令钩子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#指令钩子"}},[t._v("#")]),t._v(" 指令钩子")]),t._v(" "),s("p",[t._v("一个自定义指令由一个包含类似组件生命周期钩子的对象来定义。钩子函数会接收到指令所绑定元素作为其参数。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myDirective "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在绑定元素的 attribute 前")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或事件监听器应用前调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下面会介绍各个参数的细节")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在元素被插入到 DOM 前调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeMount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在绑定元素的父组件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 及他自己的所有子节点都挂载完成后调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定元素的父组件更新前调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在绑定元素的父组件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 及他自己的所有子节点都更新后调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updated")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定元素的父组件卸载前调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeUnmount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定元素的父组件卸载后调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unmounted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"钩子参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#钩子参数"}},[t._v("#")]),t._v(" 钩子参数")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[s("code",[t._v("el")])]),t._v("：指令绑定到的元素。这可以用于直接操作 DOM。")])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("binding")])]),t._v("：一个对象，包含以下属性。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("value")]),t._v("：传递给指令的值。例如在 "),s("code",[t._v('v-my-directive="1 + 1"')]),t._v(" 中，值是 "),s("code",[t._v("2")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("oldValue")]),t._v("：之前的值，仅在 "),s("code",[t._v("beforeUpdate")]),t._v(" 和 "),s("code",[t._v("updated")]),t._v(" 中可用。无论值是否更改，它都可用。")]),t._v(" "),s("li",[s("code",[t._v("arg")]),t._v("：传递给指令的参数 (如果有的话)。例如在 "),s("code",[t._v("v-my-directive:foo")]),t._v(" 中，参数是 "),s("code",[t._v('"foo"')]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("modifiers")]),t._v("：一个包含修饰符的对象 (如果有的话)。例如在 "),s("code",[t._v("v-my-directive.foo.bar")]),t._v(" 中，修饰符对象是 "),s("code",[t._v("{ foo: true, bar: true }")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("instance")]),t._v("：使用该指令的组件实例。")]),t._v(" "),s("li",[s("code",[t._v("dir")]),t._v("：指令的定义对象。")])])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("vnode")])]),t._v("：代表绑定元素的底层 VNode。")])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("prevNode")])]),t._v("：之前的渲染中代表指令所绑定元素的 VNode。仅在 "),s("code",[t._v("beforeUpdate")]),t._v(" 和 "),s("code",[t._v("updated")]),t._v(" 钩子中可用。")])])]),t._v(" "),s("h3",{attrs:{id:"在组件上使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在组件上使用"}},[t._v("#")]),t._v(" 在组件上使用")]),t._v(" "),s("p",[s("strong",[t._v("不")]),t._v("推荐在组件上使用自定义指令")]),t._v(" "),s("div",{staticClass:"language-vue extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vue"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("MyComponent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("v-demo")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("h2",{attrs:{id:"_3-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-插件"}},[t._v("#")]),t._v(" 3.插件")]),t._v(" "),s("p",[t._v("插件 (Plugins) 是一种能为 Vue 添加全局功能的工具代码。")]),t._v(" "),s("p",[t._v("一个插件可以是一个拥有 "),s("code",[t._v("install()")]),t._v(" 方法的对象，也可以直接是一个安装函数本身。")]),t._v(" "),s("p",[t._v("安装函数会接收到安装它的应用实例和传递给 "),s("code",[t._v("app.use()")]),t._v(" 的额外选项作为参数：")]),t._v(" "),s("p",[t._v("在**"),s("code",[t._v("src/components/index.js")]),t._v("**中定义一个插件：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置此应用")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.component('组件名字', 组件配置对象)")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("插件没有严格定义的使用范围，但是插件发挥作用的常见场景主要包括以下几种：")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("通过**"),s("code",[t._v("app.component()")]),s("strong",[t._v("和")]),s("code",[t._v("app.directive()")]),s("strong",[t._v("注册一到多个")]),t._v("全局组件"),s("strong",[t._v("或")]),t._v("自定义指令**。")]),t._v(" "),s("li",[t._v("通过 "),s("code",[t._v("app.provide()")]),t._v(" 使一个资源可被注入进整个应用。")]),t._v(" "),s("li",[t._v("向 "),s("code",[t._v("app.config.globalProperties")]),t._v(" 中添加一些全局实例属性或方法")]),t._v(" "),s("li",[t._v("一个可能上述三种都包含了的功能库 (例如 "),s("a",{attrs:{href:"https://github.com/vuejs/vue-router-next",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-router"),s("OutboundLink")],1),t._v(")。")])])]),t._v(" "),s("p",[t._v("在**"),s("code",[t._v("main.js")]),t._v("**中引入并注册")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createApp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入全局组件插件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" myPlugin "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@/components"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myPlugin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 可选的选项 */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("在其他组件上使用")])])}),[],!1,null,null,null);s.default=e.exports}}]);